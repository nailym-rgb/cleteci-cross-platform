version: 1
frontend:
  phases:
    # 1. Fase de Provisionamiento: Configura el entorno
    preBuild:
      commands:
        # Clona el SDK de Flutter
        - git clone https://github.com/flutter/flutter.git -b stable $HOME/flutter
        # A帽ade Flutter a la PATH
        - export PATH="$PATH:$HOME/flutter/bin"

        # 2.  CORRECCIN CRTICA: Inyectar '.env' como asset usando 'sed'
        #    Esto inserta 'assets:' y '- .env' con la indentaci贸n correcta (2 y 4 espacios)
        #    justo despu茅s de 'uses-material-design: true' en pubspec.yaml.
        - sed -i '/uses-material-design: true/a \ \ assets:\n\ \ \ \ - .env' pubspec.yaml

         #  Paso clave: Crear el archivo .env con las variables de Amplify
        - echo "FIREBASE_API_KEY=$FIREBASE_API_KEY_AMPLIFY" > .env
        - echo "FIREBASE_APP_ID=$FIREBASE_APP_ID_AMPLIFY" >> .env
        # Repite la l铆nea anterior para todas las variables que necesites

        # Verifica la instalaci贸n de Flutter
        - flutter doctor
        # Habilita el soporte para web
        - flutter config --enable-web
    # 2. Fase de Compilaci贸n: Compila el proyecto
    build:
      commands:
        # Asegura que Flutter est茅 en la PATH
        - export PATH="$PATH:$HOME/flutter/bin"
        # Obtiene las dependencias de pubspec.yaml
        - flutter pub get
        # Compila la aplicaci贸n web para producci贸n
        - flutter build web --release
  # 3. Artefactos: Indica qu茅 archivos subir al hosting
  artifacts:
    # El directorio donde 'flutter build web' guarda el resultado
    baseDirectory: build/web
    files:
      - '**/*'
  cache:
    paths:
      - $HOME/flutter